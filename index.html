<!DOCTYPE html>

<!--
redditgifts map maker, an open source project hosted by emilie barnard
emiliebarnard.com
-->

<html>
  <head>
  <link rel="icon" type="image/png" href="gift@2x.png"/>
  <title>redditgifts map</title>
  <link rel="stylesheet" type="text/css" href="stylesheet.css" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  
      <!--
<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
-->
	    <script type="text/javascript"
	      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBauEtRQ17iTKbRU3wC4QdFJ9ZzgJeHFF8&sensor=true">
	    </script>
	    
	    <script type="text/javascript"
	    	src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
	    </script>
	    
	    <script type="text/javascript" src="/redditgiftsmapmaker/retina.js"></script>
	    
	    <script type="text/javascript">
	    
	    var iconSize = 50;
	    var homeIconDim = 28;
	    var map;
	    
	      function initialize() {
	       
	        var mapOptions = {
	          center: new google.maps.LatLng(39.828175, -98.579500),
	          zoom: 4, 
	          minZoom: 2,
	          maxZoom: 7,
	          streetViewControl: false
	        };
	       
	        map = new google.maps.Map(document.getElementById("map-canvas"),
	            mapOptions);
	            
	            
	   		}
	      
		  
		  google.maps.event.addDomListener(window, 'load', initialize);
		  var geocoder;
		  var markersArray = new Array();
		  var homeMarker = new google.maps.Marker();
		  
  		var mapURL = "http://maps.googleapis.com/maps/api/staticmap?size=480x480&markers=icon:http://chart.apis.google.com/chart?chst=d_map_pin_icon%26chld=cafe%257C996600%7C224+West+20th+Street+NY%7C75+9th+Ave+NY%7C700+E+9th+St+NY&sensor=true";
		  
		function dropPin(){
		
			if ( $('#exchangeList').val().localeCompare("") != 0 && $('#postCode').val().localeCompare("") != 0){	
				
				geocoder = new google.maps.Geocoder();
				var post = $('#postCode').val();
				var username = $('#gifteeUsername').val();
				var exchange = $('#exchangeList').val();
				var lat;
				var lng;
				var pinDialog = '<div class="pinContent">';
				
								
				if ($('#rematchCheck').prop('checked')){
					/* alert('checked'); */
					pinDialog += '<p><b>exchange</b>: ' +  exchange + ' (rematch)'; 
				}
				
				else{
					pinDialog += '<p><b>exchange</b>: ' +  exchange
				}
				
				if (username.localeCompare("") != 0){
					pinDialog += '<br><b>giftee</b>: <a href="http://reddit.com/u/' + username + '" target="_blank">/u/' + username + '</a>';
				}

				pinDialog += '</p></div>';
				
				var pinWindow = new google.maps.InfoWindow({
			      content: pinDialog,
			      maxWidth: 200
				  });
				geocoder.geocode({address: post},
				function(results_array, status) { 
					lat = results_array[0].geometry.location.lat();
					lng = results_array[0].geometry.location.lng();
				
					var pinPos = new google.maps.LatLng(lat, lng);
					
					var pinImg = {
					    url: 'http://www.fluffaykitties.com/jemimaup1.png',
					    scaledSize: new google.maps.Size(iconSize, iconSize),
					    origin: new google.maps.Point(0, 0),
					    anchor: new google.maps.Point(iconSize/2, iconSize/2)
					};
					
					var pinMarker = new google.maps.Marker({
						position: pinPos,
						map: map,
						icon: pinImg,
						title: "MEOW",
						animation: google.maps.Animation.DROP
					});
					
					markersArray.push(pinMarker);
					document.getElementById("undoPinButton").disabled = false;
					document.getElementById("mapLinkButton").disabled = false;
					
					google.maps.event.addListener(pinMarker, 'click', function() {
					    pinWindow.open(map,pinMarker);
					  });
					  
					google.maps.event.addListener(pinMarker, 'rightclick', function() {
					    pinMarker.setMap(null);
					    pinMarker = null;
					    
					    var markerIndex = markersArray.indexOf(pinMarker);
					    markersArray.splice(markerIndex, 1);
					    
					    if (markersArray[markersArray.length-1] == null){
							document.getElementById("undoPinButton").disabled = true;
							document.getElementById("mapLinkButton").disabled = true;

						}
					  });   
				});
			}
/*
			else {
				alert("No exchange!");
			}
*/			
		};
		
		function setHome(){
			homeMarker = new google.maps.Marker();
			
			if ( $('#home').val().localeCompare("") != 0){
				homeMarker.setMap(null);
				homeMarker = null;
				geocoder = new google.maps.Geocoder();
				var post = $('#home').val();
				var user = $('#homeUsername').val();
	
				var lat;
				var lng;
				var homeDialog = '<div class="homeContent">';
				
				if (user.localeCompare("") != 0){
					homeDialog += '<p>home of <a href="http://reddit.com/u/' + user + '" target="_blank">/u/' + user + '</a></p>' + '</div>';
				}
				else{
					homeDialog += '<p>home sweet home</p>' + '</div>';
				}
				var homeWindow = new google.maps.InfoWindow({
				      content: homeDialog,
				      maxWidth: 100
				  });
				geocoder.geocode({address: post},
				function(results_array, status) { 
					lat = results_array[0].geometry.location.lat();
					lng = results_array[0].geometry.location.lng();
				
					var pinPos = new google.maps.LatLng(lat, lng);
					
					var pinImg = {
					    url: 'home@2x.png',
					    scaledSize: new google.maps.Size(homeIconDim, homeIconDim),
					    origin: new google.maps.Point(0, 0),
					    anchor: new google.maps.Point(homeIconDim/2, homeIconDim/2)
					};
					
					
					homeMarker = new google.maps.Marker({
						position: pinPos,
						map: map,
						icon: pinImg,
						title: "Home Sweet Home",
						animation: google.maps.Animation.DROP
					});
					google.maps.event.addListener(homeMarker, 'click', function() {
					    homeWindow.open(map,homeMarker);
					  });
					  
					google.maps.event.addListener(homeMarker, 'rightclick', function() {
					    homeMarker.setMap(null);
					    homeMarker = null;
					  });  
					
				});
			}			
		};
		
		function undoPin(){
			pinToUndo = markersArray[markersArray.length-1];
			if (pinToUndo != null){
				pinToUndo.setMap(null);
				pinToUndo = null;
				markersArray.pop();
				if (markersArray[markersArray.length-1] == null){
					document.getElementById("undoPinButton").disabled = true;
					document.getElementById("mapLinkButton").disabled = true;

				}
			}
		};
		
		function closeShareLinks(){
			$('#dimmer').hide();
			$('#shareBox').hide();
/* 			$('#closeShareBox').hide(); */
		}
		
		$(document).ready(function(){		
			/* $('#shareBox').hide(); */
			
			$('#mapLinkButton').click(function() {
				$('#shareBox').css("display", "inline-block");
/* 				$('#closeShareBox').css("display", "inline-block"); */
				$('#dimmer').show();
				});
	
		/* This allows the user to press enter rather than the start encryption button while in the rule number form box */
		  $("input").keypress(function(event) {
		    if (event.which == 13 && $('#postCode').val().localeCompare("") != 0) {
		        $("#dropPinButton").click();
		    }
	  }); 
    
});	 
	    </script>
    
  </head>
  <body>
  <div id="dimmer"></div>
  <div>
  	<h1><span style="color:#ff5700">reddit</span><span style="color:#336699">gifts</span> map</h1>
  	<p>required fields denoted by an *
  	</p>
  </div>
  	  	<div id="shareBox">
  	  		<a href="javascript:closeShareLinks();"><div id="closeButton"></div></a>
  	  		<!-- <div id="closeShareBox"><a href="javascript:closeShareLinks();"><img src="x.png" alt="close" height="10" width="10"/></a></div> -->
  	  		<p>Private link: 
	  	  	<br>Share link:
	  	  	<!-- <br><br><a href="javascript:closeShareLinks();"><img src="x.png" alt="close" height="10" width="10"/></a> -->
	  	  	</p>
  	</div>

  	<div id="wrapper">
  	<div id="userBox"><h2>your info</h2>
  	<p>set home location for reference<br>
  	<br>post code<span style="color:#ff5700">*</span> <input type="text" id="home" size="10" value="" required><br>
  	username <input type="text" id="homeUsername" size="10" value=""><br>
  	<input id="setHomeButton" type="button" onclick="setHome()" value="Set Home Location"></p></div>
  	<div id="gifteeBox"><h2>giftee's info</h2>
  	<p>drop giftee pins for each exchange<br><br>
  	exchange<span style="color:#336699">*</span> <select id="exchangeList" required> 
	  <option></option>
	  <!-- use the python script to generate the below part of the drop-down: -->
		<option>Tim Burton</option>
		<option>Hockey</option>
		<option>Makeup & Nail Polish 2014</option>
		<option>Marvel Universe</option>
		<option>Ugly Mugs</option>
		<option>Puzzles</option>
		<option>Tabletop RPGs</option>
		<option>Soccer</option>
		<option>T-shirt 2014</option>
		<option>Ties 2014</option>
		<option>Archer</option>
		<option>Books 2014</option>
		<option>Ghostbusters</option>
		<option>Jim Henson</option>
		<option>LEGO</option>
		<option>Stickers</option>
		<option>Yarn 2014</option>
		<option>Socks 2014</option>
		<option>Snacks 2014</option>
		<option>100th Exchange Extravaganza!</option>
		<option>DC Comics</option>
		<option>Harry Potter</option>
		<option>Lunchboxes</option>
		<option>Awesome Aprons</option>
		<option>Studio Ghibli</option>
		<option>Dinosaurs</option>
		<option>Holiday Cards 2013</option>
		<option>Secret Santa 2013</option>
		<option>reddit Trick or Treat 2013</option>
		<option>reddit Trick or Treat 2013 PLUS</option>
		<option>Presents for Pets 2013</option>
		<option>Whedon-Verse</option>
		<option>Blind Boxes and Bags</option>
		<option>NFL</option>
		<option>Avatar: The Last Airbender</option>
		<option>Board Games 2013</option>
		<option>Breaking Bad</option>
		<option>Kitchen Goods</option>
		<option>Trading Card Games</option>
		<option>Zombies</option>
		<option>redditgifts for the Teachers 2013</option>
		<option>The World's End Exchange</option>
		<option>The World's End Exchange PLUS</option>
		<option>Now Sharing Absurdity - The NSA Gift Exchange</option>
		<option>Arrested Development Exchange</option>
		<option>Hometown Exchange</option>
		<option>Game of Thrones Exchange</option>
		<option>Magnets Exchange</option>
		<option>Pints and Shot Glasses Exchange</option>
		<option>Nintendo Exchange</option>
		<option>Arbitrary Day 2013</option>
		<option>Arbitrary Day PLUS 2013</option>
		<option>Nostalgia Exchange</option>
		<option>Star Trek Exchange</option>
		<option>Disney Exchange</option>
		<option>Pens and Stationery Exchange</option>
		<option>Doctor Who (Almost) 50th Anniversary Exchange</option>
		<option>Phone Cases Exchange</option>
		<option>Ameristralia Exchange</option>
		<option>Star Wars Exchange</option>
		<option>Condiments Exchange</option>
		<option>Plushy Exchange</option>
		<option>Art Prints Exchange</option>
		<option>Simple Pleasures Exchange</option>
		<option>Awesome Smell Exchange</option>
		<option>Horror Exchange</option>
		<option>Manga Exchange</option>
		<option>T-shirt Exchange</option>
		<option>Adventure Time Exchange</option>
		<option>Fantasy Exchange</option>
		<option>Yarn Exchange 2013</option>
		<option>Book Exchange 2013</option>
		<option>Socks Exchange</option>
		<option>Coffee and Tea Exchange</option>
		<option>Hats and Scarves Exchange</option>
		<option>Snack Exchange 2013</option>
		<option>Pokemon Exchange</option>
		<option>Holiday Greeting Card Exchange</option>
		<option>Secret Santa 2012</option>
		<option>reddit Trick or Treat 2012</option>
		<option>reddit Trick or Treat PLUS</option>
		<option>Decorate my Cubicle</option>
		<option>Makeup and Nail Polish</option>
		<option>Ties</option>
		<option>Postcards</option>
		<option>Doctor Who</option>
		<option>reddit Gifts for the Teachers</option>
		<option>Comic Books and Graphic Novels</option>
		<option>Decorate Your Dorm</option>
		<option>Vinyl Exchange</option>
		<option>Presents for Pets</option>
		<option>Arbitrary Day PLUS</option>
		<option>Arbitrary Day 2012</option>
		<option>redditgifts for the troops</option>
		<option>Awesomesocks</option>
		<option>Board Games</option>
		<option>My Little Pony</option>
		<option>Cookbooks</option>
		<option>yarn exchange 2012</option>
		<option>r/books 2012</option>
		<option>T-Shirts 2012</option>
		<option>Secret Santa 2011</option>
		<option>Coffee Mugs and Tea Cups 2011</option>
		<option>reddit Trick or Treat 2011</option>
		<option>Arbitrary Day 2011</option>
		<option>r/snackexchange 2011</option>
		<option>r/craftexchange 2011</option>
		<option>r/books 2011</option>
		<option>Secret Santa 2010</option>
		<option>Arbitrary Day 2010</option>
		<option>Secret Santa 2009</option>
		<!-- use the python script to generate the above part of the drop-down: -->
	</select><br>
  	post code<span style="color:#336699">* </span><input type="text" id="postCode" size="10" value="" required><br>
  	username <input type="text" id="gifteeUsername" size="10" value=""><br>
  	rematch? <input type="checkbox" id="rematchCheck"><br>

  	<input id="dropPinButton" type="button" onclick="dropPin()" value="Drop Pin!"> 
  	<input id="undoPinButton" type="button" onclick="undoPin()" value="Undo Pin" disabled><p></div>
  	</div>
  	<div id="bottomWrapper"></div>
  	<div><p><br>click dropped pins for more info
  	<br>right click to remove any pin  	
  	</p>
  	<input id="mapLinkButton" type="button" value="Generate Links" disabled></div>

    <div id="map-canvas"></div>
    <div id="copyright">This site is not affiliated with nor endorsed by <a href="http://www.reddit.com">reddit</a> or <a href="http://www.redditgifts.com">redditgifts</a>.<br><br>Emilie Menard Barnard<br><a href="http://www.reddit.com/user/Fluffaykitties/">/u/fluffaykitties</a><br><a href="http://emiliebarnard.com">emiliebarnard.com</a></div>
  </body>
</html>
