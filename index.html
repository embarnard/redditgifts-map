<!DOCTYPE html>

<!--
redditgifts map maker, an open source project hosted by emilie barnard
emiliebarnard.com
-->

<html>
  <head>
  <link rel="icon" type="image/png" href="gift@2x.png"/>
  <title>redditgifts map</title>
  <link rel="stylesheet" type="text/css" href="stylesheet.css" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  
      <!--
<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
-->
	    <script type="text/javascript"
	      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBauEtRQ17iTKbRU3wC4QdFJ9ZzgJeHFF8&sensor=true">
	    </script>
	    
	    <script type="text/javascript"
	    	src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
	    </script>
	    
	    <script type="text/javascript" src="/redditgiftsmapmaker/retina.js"></script>
	    
	    <script type="text/javascript">
	    
	    var iconSize = 50;
	    var homeIconDim = 28;
	    var map;
	    
	      function initialize() {
	       
	        var mapOptions = {
	          center: new google.maps.LatLng(39.828175, -98.579500),
	          zoom: 4, 
	          minZoom: 2,
	          maxZoom: 7,
	          streetViewControl: false
	        };
	       
	        map = new google.maps.Map(document.getElementById("map-canvas"),
	            mapOptions);
	            
	            
	   		}
	      
		  
		  google.maps.event.addDomListener(window, 'load', initialize);
		  var geocoder;
		  var markersArray = new Array();
		  var homeMarker = new google.maps.Marker();
		  
  		var mapURL = "http://maps.googleapis.com/maps/api/staticmap?size=480x480&markers=icon:http://chart.apis.google.com/chart?chst=d_map_pin_icon%26chld=cafe%257C996600%7C224+West+20th+Street+NY%7C75+9th+Ave+NY%7C700+E+9th+St+NY&sensor=true";
		  
		function dropPin(){
		
			if ( $('#exchangeList').val().localeCompare("") != 0 && $('#postCode').val().localeCompare("") != 0){	
				
				geocoder = new google.maps.Geocoder();
				var post = $('#postCode').val();
				var username = $('#gifteeUsername').val();
				var exchange = $('#exchangeList').val();
				var lat;
				var lng;
				var pinDialog = '<div class="pinContent">';
				
				if (username.localeCompare("") != 0){
					pinDialog += '<p><b>Exchange</b>: ' +  exchange + '<br><b>Giftee</b>: <a href="http://reddit.com/u/' + username + '" target="_blank">/u/' + username + '</a></p>'+'</div>';
				}
				else {
					pinDialog += '<p><b>Exchange</b>: ' +  exchange + '</p>' + '</div>'
				}
				
				var pinWindow = new google.maps.InfoWindow({
			      content: pinDialog,
			      maxWidth: 125
				  });
				geocoder.geocode({address: post},
				function(results_array, status) { 
					lat = results_array[0].geometry.location.lat();
					lng = results_array[0].geometry.location.lng();
				
					var pinPos = new google.maps.LatLng(lat, lng);
					
					var pinImg = {
					    url: 'http://www.fluffaykitties.com/jemimaup1.png',
					    scaledSize: new google.maps.Size(iconSize, iconSize),
					    origin: new google.maps.Point(0, 0),
					    anchor: new google.maps.Point(iconSize/2, iconSize/2)
					};
					
					var pinMarker = new google.maps.Marker({
						position: pinPos,
						map: map,
						icon: pinImg,
						title: "MEOW",
						animation: google.maps.Animation.DROP
					});
					
					markersArray.push(pinMarker);
					document.getElementById("undoPinButton").disabled = false;
					document.getElementById("mapLinkButton").disabled = false;
					
					google.maps.event.addListener(pinMarker, 'click', function() {
					    pinWindow.open(map,pinMarker);
					  });
					  
					google.maps.event.addListener(pinMarker, 'rightclick', function() {
					    pinMarker.setMap(null);
					    pinMarker = null;
					    
					    var markerIndex = markersArray.indexOf(pinMarker);
					    markersArray.splice(markerIndex, 1);
					    
					    if (markersArray[markersArray.length-1] == null){
							document.getElementById("undoPinButton").disabled = true;
							document.getElementById("mapLinkButton").disabled = true;

						}
					  });   
				});
			}
/*
			else {
				alert("No exchange!");
			}
*/			
		};
		
		function setHome(){
			homeMarker = new google.maps.Marker();
			
			if ( $('#home').val().localeCompare("") != 0){
				homeMarker.setMap(null);
				homeMarker = null;
				geocoder = new google.maps.Geocoder();
				var post = $('#home').val();
				var user = $('#homeUsername').val();
	
				var lat;
				var lng;
				var homeDialog = '<div class="homeContent">';
				
				if (user.localeCompare("") != 0){
					homeDialog += '<p>Home of <a href="http://reddit.com/u/' + user + '" target="_blank">/u/' + user + '</a></p>' + '</div>';
				}
				else{
					homeDialog += '<p>Home Sweet Home</p>' + '</div>';
				}
				var homeWindow = new google.maps.InfoWindow({
				      content: homeDialog,
				      maxWidth: 100
				  });
				geocoder.geocode({address: post},
				function(results_array, status) { 
					lat = results_array[0].geometry.location.lat();
					lng = results_array[0].geometry.location.lng();
				
					var pinPos = new google.maps.LatLng(lat, lng);
					
					var pinImg = {
					    url: 'home@2x.png',
					    scaledSize: new google.maps.Size(homeIconDim, homeIconDim),
					    origin: new google.maps.Point(0, 0),
					    anchor: new google.maps.Point(homeIconDim/2, homeIconDim/2)
					};
					
					
					homeMarker = new google.maps.Marker({
						position: pinPos,
						map: map,
						icon: pinImg,
						title: "Home Sweet Home",
						animation: google.maps.Animation.DROP
					});
					google.maps.event.addListener(homeMarker, 'click', function() {
					    homeWindow.open(map,homeMarker);
					  });
					  
					google.maps.event.addListener(homeMarker, 'rightclick', function() {
					    homeMarker.setMap(null);
					    homeMarker = null;
					  });  
					
				});
			}			
		};
		
		function undoPin(){
			pinToUndo = markersArray[markersArray.length-1];
			if (pinToUndo != null){
				pinToUndo.setMap(null);
				pinToUndo = null;
				markersArray.pop();
				if (markersArray[markersArray.length-1] == null){
					document.getElementById("undoPinButton").disabled = true;
					document.getElementById("mapLinkButton").disabled = true;

				}
			}
		};
		
		function closeShareLinks(){
			$('#dimmer').hide();
			$('#shareBox').hide();
/* 			$('#closeShareBox').hide(); */
		}
		
		$(document).ready(function(){		
			/* $('#shareBox').hide(); */
			
			$('#mapLinkButton').click(function() {
				$('#shareBox').css("display", "inline-block");
/* 				$('#closeShareBox').css("display", "inline-block"); */
				$('#dimmer').show();
				});
	
		/* This allows the user to press enter rather than the start encryption button while in the rule number form box */
		  $("input").keypress(function(event) {
		    if (event.which == 13 && $('#postCode').val().localeCompare("") != 0) {
		        $("#dropPinButton").click();
		    }
	  }); 
    
});	 
	    </script>
    
  </head>
  <body>
  <div id="dimmer"></div>
  <div>
  	<h1><span style="color:#ff5700">reddit</span><span style="color:#336699">gifts</span> map</h1>
  	<p>right click to remove any pin</p>
  </div>
  	  	<div id="shareBox">
  	  		<a href="javascript:closeShareLinks();"><div id="closeButton"></div></a>
  	  		<!-- <div id="closeShareBox"><a href="javascript:closeShareLinks();"><img src="x.png" alt="close" height="10" width="10"/></a></div> -->
  	  		<p>Private link: 
	  	  	<br>Share link:
	  	  	<!-- <br><br><a href="javascript:closeShareLinks();"><img src="x.png" alt="close" height="10" width="10"/></a> -->
	  	  	</p>
  	</div>

  	<div id="wrapper">
  	<div id="userBox"><h2>your info</h2>
  	<p>Post Code<span style="color:#ff5700">*</span>: <input type="text" id="home" size="10" value=""><br>
  	Username: <input type="text" id="homeUsername" size="10" value=""><br>
  	<input id="setHomeButton" type="button" onclick="setHome()" value="Set Home Location"></p></div>
  	<div id="gifteeBox"><h2>giftee's info</h2>
  	<p>
  	Exchange<span style="color:#336699">*</span>: <select id="exchangeList">
	  <option></option>
	  <option>Lego</option>
	  <option>Snacks</option>  
	  <option>100</option>
	  <option>Socks</option>
	  <option>Puzzles</option>
	</select><br>
  	Post Code<span style="color:#336699">*</span>: <input type="text" id="postCode" size="10" value=""><br>
  	Username: <input type="text" id="gifteeUsername" size="10" value=""><br>

  	<input id="dropPinButton" type="button" onclick="dropPin()" value="Drop Pin!"> 
  	<input id="undoPinButton" type="button" onclick="undoPin()" value="Undo Pin" disabled><p></div>
  	</div>
  	<div id="bottomWrapper"></div>
  	<input id="mapLinkButton" type="button" value="Generate Links" disabled>

    <div id="map-canvas"></div>
    <div id="copyright">This site is not affiliated with nor endorsed by <a href="http://www.reddit.com">reddit</a> or <a href="http://www.redditgifts.com">redditgifts</a>.<br><br>Emilie Menard Barnard<br><a href="http://www.reddit.com/user/Fluffaykitties/">/u/fluffaykitties</a><br><a href="http://emiliebarnard.com">emiliebarnard.com</a></div>
  </body>
</html>
