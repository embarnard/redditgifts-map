<!DOCTYPE html>

<!--
redditgifts map maker, an open source project hosted by emilie barnard
emiliebarnard.com
-->

<html>
  <head>
  <link rel="icon" type="image/png" href="gift@2x.png"/>
  <title>redditgifts map</title>
  <link rel="stylesheet" type="text/css" href="stylesheet.css" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	    <script type="text/javascript"
	      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBauEtRQ17iTKbRU3wC4QdFJ9ZzgJeHFF8&sensor=true">
	    </script>
	    
	    <script type="text/javascript"
	    	src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
	    </script>
	    
	    <script type="text/javascript" src="/redditgiftsmapmaker/retina.js"></script>
	    
	    <script type="text/javascript">
	    
	    var iconSizeX = 37; /* ratio should be close to 29/40 */
	    var iconSizeY = 51;
	    var homeIconDim = 28;
	    var map;
	    var loadedURL;
	    
	      function initialize() {
	       
	        var mapOptions = {
	          center: new google.maps.LatLng(39.828175, -98.579500),
	          zoom: 4, 
	          minZoom: 2,
	          maxZoom: 7,
	          streetViewControl: false
	        };
	       
	        map = new google.maps.Map(document.getElementById("map-canvas"),
	            mapOptions);
	            
          loadedURL = window.location.href;
          setHeader();
	            
	   		}
	   		google.maps.event.addDomListener(window, 'load', initialize);
	   		var homeMarker = new google.maps.Marker();
	   		
	   	function setHeader(){ //also sets home
	   		var userInfoInURL = loadedURL.replace("http://embarnard.com/redditgiftsmapmaker/share/?","");
	   		var userInfo = "";
	   		var i = 0;
	   		var commaCount = 0;
	   		var lat = "";
	   		var lng = "";
	   		var userName = "";
	   		
	   		while (userInfoInURL.charAt(i).localeCompare("&") != 0){
		   		userInfo += userInfoInURL.charAt(i);
		   		//comma check:
		   		if (userInfoInURL.charAt(i).localeCompare(",") == 0){
			   		commaCount ++;
		   		}
		   		i++;
	   		}
	   		
	   		i=0; //reset
	   			   		
	   		//if comma count is zero, no user info given
	   		
	   		//if comma count is one, we have the location but not the username:
	   		if (commaCount == 1){
		   		while (userInfo.charAt(i).localeCompare(",") != 0){
		   			lat += userInfo.charAt(i);
		   			i++;
		   		}
		   		lat = parseFloat(lat, "10");
		   		
		   		i++; //get past the comma
		   		
		   		while (i < userInfo.length){
			   		lng += userInfo.charAt(i);
			   		i++;
		   		}
		   		
		   		lng = parseFloat(lng, "10");
		   		
		   		
		   		//drop home pin:
		   		// geocoder = new google.maps.Geocoder();
		   		
		   		var homeDialog = '<div class="homeContent">' + '<p>home sweet home</p>' + '</div>';
		   		
		   		var homeWindow = new google.maps.InfoWindow({
		   			  content: homeDialog,
		   			  maxWidth: 100
		   		  });
		   		// geocoder.geocode({address: post},
		   		// function(results_array, status) { 
		   		// 	lat = results_array[0].geometry.location.lat();
		   		// 	lng = results_array[0].geometry.location.lng();
		   		
		   			var pinPos = new google.maps.LatLng(lat, lng);
		   			
		   			var pinImg = {
		   				url: 'home@2x.png',
		   				scaledSize: new google.maps.Size(homeIconDim, homeIconDim),
		   				origin: new google.maps.Point(0, 0),
		   				anchor: new google.maps.Point(homeIconDim/2, homeIconDim/2)
		   			};
		   			homeMarker = new google.maps.Marker({
		   				position: pinPos,
		   				map: map,
		   				icon: pinImg,
		   				title: "Home Sweet Home",
		   				animation: google.maps.Animation.DROP
		   			});
		   			google.maps.event.addListener(homeMarker, 'click', function() {
		   				homeWindow.open(map,homeMarker);
		   			  });
	   		
		// });
	}	   		
	   		//if comma count is two, we have the location and the username:
	   		if (commaCount == 2){
		   		//get username:
		   		while (userInfo.charAt(i).localeCompare(",") != 0){
			   		userName += userInfo.charAt(i);
			   		i++;
			   	}
			   	
			   	//set header to have username in it:
			   	var headerTag = document.getElementById("header");
			   	var currentHeader = headerTag.innerHTML;
			   	headerTag.innerHTML = currentHeader + " for " + userName;
			   	
			   	i++; //get past the comma
			   	
			   	//get position
			   	while (userInfo.charAt(i).localeCompare(",") != 0){
			   	   			lat += userInfo.charAt(i);
			   	   			i++;
				}
				lat = parseFloat(lat, "10");
				
				
				i++; //get past the comma
				
				while (i < userInfo.length){
				   	lng += userInfo.charAt(i);
				   	i++;
				}
				lng = parseFloat(lng, "10");
				
				
				//drop home pin:
				// geocoder = new google.maps.Geocoder();
				
				var homeDialog = '<div class="homeContent">' + '<p>home of <a href="http://reddit.com/u/' + userName + '" target="_blank">/u/' + userName + '</a></p>' + '</div>';
				
				var homeWindow = new google.maps.InfoWindow({
					  content: homeDialog,
					  maxWidth: 100
				  });
				var pinPos = new google.maps.LatLng(lat, lng);
				  
				  var pinImg = {
				  	url: 'home@2x.png',
				  	scaledSize: new google.maps.Size(homeIconDim, homeIconDim),
				  	origin: new google.maps.Point(0, 0),
				  	anchor: new google.maps.Point(homeIconDim/2, homeIconDim/2)
				  };
				    
				  
				homeMarker = new google.maps.Marker({
					position: pinPos,
					map: map,
					icon: pinImg,
					title: "Home Sweet Home",
					animation: google.maps.Animation.DROP
				});
				google.maps.event.addListener(homeMarker, 'click', function() {
					homeWindow.open(map,homeMarker);
				  });
				// geocoder.geocode({address: post},
				// function(results_array, status) { 
				// 	lat = results_array[0].geometry.location.lat();
				// 	lng = results_array[0].geometry.location.lng();
				
					var pinPos = new google.maps.LatLng(lat, lng);
					
					var pinImg = {
						url: 'home@2x.png',
						scaledSize: new google.maps.Size(homeIconDim, homeIconDim),
						origin: new google.maps.Point(0, 0),
						anchor: new google.maps.Point(homeIconDim/2, homeIconDim/2)
					};
			   	
	   		// });
	   	}
	   		
			//  		if (userName.localeCompare("") != 0){
			// 	var headerTag = document.getElementById("header");
			// 	var currentHeader = headerTag.innerHTML;
			// 	headerTag.innerHTML = currentHeader + " for " + userName;
			// }
}
 
	    </script>  
  </head>
  
  
  
  <body>
  	<h1 id="header"><span style="color:#ff5700">reddit</span><span style="color:#336699">gifts</span> map</h1>
  	<div id="map-canvas"></div>
    <div id="copyright">This site is not affiliated with nor endorsed by <a href="http://www.reddit.com">reddit</a> or <a href="http://www.redditgifts.com">redditgifts</a>.<br><br>Emilie Menard Barnard<br><a href="http://www.reddit.com/user/Fluffaykitties/">/u/fluffaykitties</a><br><a href="http://emiliebarnard.com">emiliebarnard.com</a></div>
  </body>
</html>